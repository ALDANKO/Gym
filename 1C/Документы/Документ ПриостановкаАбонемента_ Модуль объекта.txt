
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	// регистр ЖурналОстановок зарегистрируем остановку
	Движения.ЖурналОстановок.Записывать = Истина;
	Движения.ЖурналОстановок.Очистить();
	Движение 				= Движения.ЖурналОстановок.Добавить();
	Движение.Период 		= ЭтотОбъект.Дата;
	Движение.Абонемент 		= ЭтотОбъект.Абонемент;
	Движение.ВидАбонемента 	= ЭтотОбъект.Абонемент.ВидАбонемента;
	Движение.КоличествоДней	= ЭтотОбъект.ДнейЗапаса;
	Движение.ДатаОстановки	= ЭтотОбъект.ДатаОстановки;
	Если ЗначениеЗаполнено(ЭтотОбъект.ДатаВозобновления) 
			тогда // регистр ЖурналОстановок зарегистрируем Продолжение
		Движение.ДатаВозобновления	= ЭтотОбъект.ДатаВозобновления;		
	КонецЕсли;
	Движения.Записать();
	
	Если ЗначениеЗаполнено(ЭтотОбъект.ВремяДействия) И ЗначениеЗаполнено(ЭтотОбъект.ДокументОплаты) тогда
		 НаборЗаписей = РегистрыСведений.ВремяДействияАбонемента.СоздатьНаборЗаписей();
         НаборЗаписей.Отбор.Регистратор.Установить(ЭтотОбъект.ДокументОплаты.Ссылка);
         НаборЗаписей.Прочитать();
		 НаборЗаписей[0].ДатаОкончания=ЭтотОбъект.ДатаОстановки;
		 НаборЗаписей.Записать();
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ЭтотОбъект.ДатаВозобновления) тогда
		
		Движения.ВремяДействияАбонемента.Записывать = Истина;
        Продление 				= Движения.ВремяДействияАбонемента.Добавить();
		Продление.Абонемент=ЭтотОбъект.Абонемент;
		Продление.Активность=Истина;
		Продление.ВидАбонемента=ЭтотОбъект.Абонемент.ВидАбонемента;
		Продление.ДатаНачала	=ЭтотОбъект.ДатаВозобновления;//***20160212
		Продление.ДатаОкончания=ЭтотОбъект.ДатаВозобновления+ЭтотОбъект.ДнейЗапаса*24*3600;
		//*** 04-03-16 Продление.Период		=ТекущаяДата();
		Продление.Период		=ЭтотОбъект.ДатаВозобновления;
		Продление.Регистратор	=ЭтотОбъект.Ссылка;
		Движения.Записать();
	КонецЕсли;	
	
КонецПроцедуры

Процедура ОбработкаУдаленияПроведения(Отказ)
	Если ЗначениеЗаполнено(ЭтотОбъект.ВремяДействия) И ЗначениеЗаполнено(ЭтотОбъект.ДокументОплаты) тогда
		 НаборЗаписей = РегистрыСведений.ВремяДействияАбонемента.СоздатьНаборЗаписей();
         НаборЗаписей.Отбор.Регистратор.Установить(ЭтотОбъект.ДокументОплаты.Ссылка);
         НаборЗаписей.Прочитать();
		 Если НаборЗаписей.Количество()>0 тогда
		 	НаборЗаписей[0].ДатаОкончания=ЭтотОбъект.ВремяДействия;
		  	НаборЗаписей.Записать();
		КонецЕсли;	
	КонецЕсли;
КонецПроцедуры
