
Процедура ОбработкаПроведения(Отказ, Режим)
	мКонтрагент	= Справочники.Контрагенты.НайтиПоКоду("000000002");
	мДоговор	= мКонтрагент.ОсновнойДоговорКонтрагента;
	// регистр ВремяДействияАбонемента
	Движения.ВремяДействияАбонемента.Записывать = Истина;
	Движения.ВремяДействияАбонемента.Очистить();
	Движение 				= Движения.ВремяДействияАбонемента.Добавить();
	Движение.Период 		= ЭтотОбъект.Дата;
	Движение.Абонемент 		= ЭтотОбъект.Абонемент;
	Движение.ВидАбонемента 	= ЭтотОбъект.ВидАбонемента;
	Движение.ДатаОкончания 	= ЭтотОбъект.СрокДействия;
	Движение.ДатаНачала		= ЭтотОбъект.НачалоДействия;
	Движения.Записать();


	// регистр ВзаиморасчетыСКонтрагентами Приход
	Движения.ВзаиморасчетыСКонтрагентами.Записывать = Истина;
	Движения.ВзаиморасчетыСКонтрагентами.Очистить();
	Движение = Движения.ВзаиморасчетыСКонтрагентами.Добавить();
	Движение.ВидДвижения 	= ВидДвиженияНакопления.Приход;
	Движение.Период 		= ЭтотОбъект.Дата;
	Движение.ДоговорКонтрагента = мДоговор;
	Движение.Организация 	= ЭтотОбъект.Организация;
	Движение.Контрагент 		= мКонтрагент;
	Движение.СуммаВзаиморасчетов= ЭтотОбъект.Сумма;
	Движение.СуммаУпр 			= ЭтотОбъект.Сумма;
    Движения.Записать();
	// регистр ВзаиморасчетыСКонтрагентамиПоДокументамРасчетов Приход
	Движения.ВзаиморасчетыСКонтрагентамиПоДокументамРасчетов.Записывать = Истина;
	Движения.ВзаиморасчетыСКонтрагентамиПоДокументамРасчетов.Очистить();
	Движение = Движения.ВзаиморасчетыСКонтрагентамиПоДокументамРасчетов.Добавить();
	Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение.Период 			= ЭтотОбъект.Дата;
	Движение.ДоговорКонтрагента = мДоговор;
	Движение.ДокументРасчетовСКонтрагентом = ЭтотОбъект.Ссылка;
	Движение.ВидРасчетовСКонтрагентом = Перечисления.ВидыРасчетовСКонтрагентами.ПоРеализации;
	Движение.Организация 		= ЭтотОбъект.Организация;
	Движение.Контрагент 		= мКонтрагент;
	Движение.СуммаВзаиморасчетов= ЭтотОбъект.Сумма;
	Движения.Записать();
	// регистр ДвиженияДенежныхСредств 
	Движения.ДвиженияДенежныхСредств.Записывать = Истина;
	Движения.ДвиженияДенежныхСредств.Очистить();
	Движение = Движения.ДвиженияДенежныхСредств.Добавить();
	Движение.Период 			= ЭтотОбъект.Дата;
	Движение.БанковскийСчетКасса= ЭтотОбъект.Касса;
	Движение.ВидДенежныхСредств = Перечисления.ВидыДенежныхСредств.Наличные;
	Движение.ПриходРасход 		= ВидДвиженияНакопления.Приход;
	Движение.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.ОплатаПокупателя;
	Движение.ДокументДвижения 	= ЭтотОбъект.Ссылка;
	Движение.Контрагент 		= мКонтрагент;
	Движение.ДоговорКонтрагента = мДоговор;
	Движение.ДокументРасчетовСКонтрагентом = ЭтотОбъект.Ссылка;
	Движение.Организация 		= ЭтотОбъект.Организация;
	Движение.Сумма 				= ЭтотОбъект.Сумма;
	Движение.СуммаУпр 			= ЭтотОбъект.Сумма;
    Движения.Записать();
	// регистр ДенежныеСредства Приход
	Движения.ДенежныеСредства.Записывать = Истина;
	Движения.ДенежныеСредства.Очистить();
	Движение = Движения.ДенежныеСредства.Добавить();
	Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение.Период 			= ЭтотОбъект.Дата;
	Движение.ВидДенежныхСредств = Перечисления.ВидыДенежныхСредств.Наличные;
	Движение.БанковскийСчетКасса = ЭтотОбъект.Касса;
	Движение.Организация 		= ЭтотОбъект.Организация;
	Движение.Сумма 				= ЭтотОбъект.Сумма;
	Движение.СуммаУпр 			= ЭтотОбъект.Сумма;
	Движения.Записать();

	// регистр РасчетыСКонтрагентами Приход
	Движения.РасчетыСКонтрагентами.Записывать = Истина;
	Движения.РасчетыСКонтрагентами.Очистить();
	Движение = Движения.РасчетыСКонтрагентами.Добавить();
	Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение.Период 			= ЭтотОбъект.Дата;
	Движение.ДоговорКонтрагента = мДоговор;
	Движение.Организация 		= ЭтотОбъект.Организация;
	Движение.Контрагент 		= мКонтрагент;
	Движение.СуммаВзаиморасчетов = ЭтотОбъект.Сумма;
	Движение.СуммаУпр 			= ЭтотОбъект.Сумма;
	Движения.Записать();
	
	//*** Групповые абонементы
	Если ВидАбонемента.Родитель.Код="00000000038" или
		 ВидАбонемента.Родитель.Родитель.Код="00000000038" Тогда
		 Движения.ОплаченныеПосещения.Записывать =  Истина;
		 Движения.ОплаченныеПосещения.Очистить();
		 Движение = Движения.ОплаченныеПосещения.Добавить();
		 Движение.ВидДвижения 		= ВидДвиженияНакопления.Приход;
		 Движение.Период 			= ЭтотОбъект.Дата;
		 Движение.Абонемент			= Абонемент;
		 Движение.ВидАбонемента		= ВидАбонемента;
		 Движение.Количество		= ВидАбонемента.КоличествоПосещений;
		 Движения.Записать();
	КонецЕсли; 
	 
	//// регистр ВзаиморасчетыСПодотчетнымиЛицами Расход
	Если ЭтотОбъект.АрендаПриОплате тогда
		мА=Абонемент.ПолучитьОбъект();
		мА.ВидОплатыУслуг=Перечисления.ВидОплатыУслуг.Аренда;
		мА.Записать();
	КонецЕсли;
	Если ЗначениеЗаполнено(ПриходящийТренер) 
			И Абонемент.ВидОплатыУслуг=Перечисления.ВидОплатыУслуг.Аренда тогда
			Движения.ВзаиморасчетыСПодотчетнымиЛицами.Записывать = Истина;
			Движения.ВзаиморасчетыСПодотчетнымиЛицами.Очистить();
			Движение = Движения.ВзаиморасчетыСПодотчетнымиЛицами.Добавить();
			Движение.ВидДвижения 	= ВидДвиженияНакопления.Приход;
			Движение.Период 	 	= Дата;
			Движение.ФизЛицо 		= ПриходящийТренер;
			Движение.РасчетныйДокумент 		= Ссылка;
			Движение.Организация 			= Организация;
			СуммаТренера=Константы.СуммаАрендыЗала.Получить();
			Движение.СуммаВзаиморасчетов 	= СуммаТренера;
			Движение.СуммаУпр 				= СуммаТренера;
			Движение.Регистратор			= Ссылка;
	КонецЕсли;
КонецПроцедуры

